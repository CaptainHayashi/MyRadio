<script type="text/javascript">
    var wcbase = '{{ plugin.vars.webcam_prefix }}';
    var wcurls = {{ cameras|json_encode() }};
    var wcCurrent = '{{ plugin.vars.current }}';
        			
    $(document).ready(function(){
      var wcid; //Yay scope.
      for (wcid in wcurls) {
        $('button#setactive'+wcid).attr('wcid',wcid).click(function(){setCam(this);});
        console.log('Enabling Webcam Selector Option '+wcid);
      }
      $('button#setactive'+wcCurrent).button("disable");
      setInterval('updateCurrentWebcam()', 2600);
        
      $('button#setactive6').click(function(){$('div#customcam').toggle('blind',200);});
      $('button#setcustomcam').click(function(){setCam(6,$('input#camurl').val());});
    });
    function setCam(element) {
      var newcam = $(element).attr('wcid');
      if (newcam == wcCurrent) {
        console.log('Ignoring setCam - Already current webcam.');
        return;
      }
      console.log('Updating webcam to '+newcam);
      $.get(myury.makeURL('SIS', 'webcam.set'), {'src':newcam, 'url':null}, function(data){updateCurrentWebcam()});
    }
        			
    function updateCurrentWebcam() {
      if (!$('div#plugin_body_webcam').is(':visible')) return;
      $.get(myury.makeURL('SIS', 'webcam.get'), function(data) {
        if (data == 'error') return;
        data = data.split("\t");
        if (wcCurrent != data[0]) {
          wcCurrent = data[0];
          $('button[id^=setactive]:not([id=setactive'+wcCurrentStudio+'])').button("enable");
          $('button#setactive'+wcCurrentStudio).button("disable");
        }
              
        //Only show side images for not-active cameras, or all for jukebox
        if (wcCurrentStudio === 0) {
          $('#plugin_body_webcam figure').show();
        } else {
          $('#plugin_body_webcam figure').hide();
          $('#plugin_body_webcam figure:not(#webcam-stream-'+wcCurrent+')').show();
        }
      });
    }
  </script>

  <figure class="webcam-stream-container live" id="webcam-stream-live">
      <img src="{{ plugin.vars.webcam_prefix }}current" class="webcam-stream" width="150px" id="wccurrent" alt="current webcam">
      <figcaption>Live</figcaption>
    </figure>

  {% for stream in plugin.vars.streams if stream.streamid in 2..4 %}
    <figure class="webcam-stream-container" id="webcam-stream-{{stream.streamid}}">
      <img src="{{stream.liveurl}}" class="webcam-stream" width="70px">
      <figcaption>{{stream.streamname}}</figcaption>
    </figure>
  {% endfor %}
  Activate:
  <button id="setactive2" class="btn">S1</button>
  <button id="setactive3" class="btn">FC</button>
  <button id="setactive4" class="btn">S2</button>
  <button id="setactive1" class="btn">JB</button>

  <!--<button id="setactive6" class="btn">Custom</button>
  <div style="margin-top: .5em;" class="invisible" id="customcam">
    <label for="camurl">File:</label> <input type="text" style="width:150px; border:1px solid black;" id="camurl"> <span id="setcustomcam" class="btn btnenabled">Set</span>
  </div>-->