/*! jQuery UI context menu plugin - v0.4.0 - 2013-05-28 |  https://github.com/mar10/jquery-ui-contextmenu |  Copyright (c) 2013 Martin Wendt; Licensed MIT */
(function(e,t,n){function i(e){return e&&e.match(/^#/)?e.substring(1):e||""}var s="onselectstart"in n.createElement("div");e.widget("ui.contextmenu",{version:"0.4.0",options:{delegate:"[data-menu]",hide:{effect:"fadeOut",duration:"fast"},show:{effect:"slideDown",duration:"slow"},position:null,ignoreParentSelect:!0,menu:null,preventSelect:!1,taphold:!1,beforeOpen:e.noop,blur:e.noop,close:e.noop,create:e.noop,focus:e.noop,init:e.noop,open:e.noop,select:e.noop},_create:function(){var t,i,o=this.options;this.$headStyle=null,this.orgMenu=null,this.currentTarget=null,this.ns="."+this.widgetName,o.preventSelect&&(i=(e(this.element).is(n)?e("body"):this.element).uniqueId().attr("id"),this.$headStyle=e("<style class='ui-contextmenu-style'>").prop("type","text/css").html("#"+i+" "+o.delegate+" { "+"-webkit-user-select: none; "+"-khtml-user-select: none; "+"-moz-user-select: none; "+"-ms-user-select: none; "+"user-select: none; "+"}").appendTo("head"),s&&this.element.delegate(o.delegate,"selectstart"+this.ns,function(e){e.preventDefault()})),e.isArray(o.menu)&&(this.orgMenu=o.menu,o.menu=e.ui.contextmenu.createMenuMarkup(o.menu)),this._getMenu().hide().addClass("ui-contextmenu").menu({blur:e.proxy(this.options.blur,this),create:e.proxy(this.options.create,this),focus:e.proxy(this.options.focus,this),select:e.proxy(function(e,t){e.relatedTarget=this.currentTarget;var n=t.item.has(">a[aria-haspopup='true']").length>0;n&&this.options.ignoreParentSelect||(this._trigger.call(this,"select",e,t)!==!1&&this._closeMenu.call(this),e.preventDefault())},this)}),t="contextmenu"+this.ns,o.taphold&&(t+=" taphold"+this.ns),this.element.delegate(o.delegate,t,e.proxy(this._openMenu,this)),this._trigger("init")},_destroy:function(){this.$headStyle&&(this.$headStyle.remove(),this.$headStyle=null),this.orgMenu&&(this.options.menu.remove(),this.options.menu=this.orgMenu,this.orgMenu=null)},_openMenu:function(t){var i=this.options,s=i.position,o=this,r=this._getMenu(),u=t,l=u.target?u.target:u,a={menu:r};return this.currentTarget=u.target,t.preventDefault(),t.relatedTarget=this.currentTarget,this._trigger("beforeOpen",t,a)===!1?!1:(e(n).bind("keydown"+this.ns,function(t){t.which===e.ui.keyCode.ESCAPE&&o._closeMenu()}).bind("mousedown"+this.ns+" touchstart"+this.ns,function(t){e(t.target).closest(".ui-menu-item").length||o._closeMenu()}),e.isFunction(s)&&(s=s(t,a)),s=e.extend({my:"left top",at:"left bottom",of:l,collision:"fit"},s),r.show().css({position:"absolute",left:0,top:0}).position(s).hide(),this._show(r,this.options.show,function(){o._trigger.call(o,"open",t)}),undefined)},_closeMenu:function(){var t=this,i=this._getMenu();this._hide(i,this.options.hide,function(){t._trigger("close"),this.currentTarget=null}),e(n).unbind("mousedown"+this.ns).unbind("touchstart"+this.ns).unbind("keydown"+this.ns)},_setOption:function(t,n){switch(t){case"menu":this.replaceMenu(n)}e.Widget.prototype._setOption.apply(this,arguments)},_getMenu:function(){var t=this.options.menu;return"string"==typeof t?e(t):t},open:function(e){var t=jQuery.Event("contextmenu",{target:e.get(0)});return this.element.trigger(t)},close:function(){return this._closeMenu.call(this)},enableEntry:function(e,t){var n=this.element.find("a[href=#"+i(e)+"]");n.toggleClass("ui-state-disabled",t===!1)},replaceMenu:function(t){var n=this.options,i=this._getMenu();e.isArray(t)?this.orgMenu?(i.empty(),e.ui.contextmenu.createMenuMarkup(t,n.menu),i.menu("refresh")):e.error("not implemented"):e.error("not implemented")},setEntry:function(t,n){var s,o=this.element.find("a[href=#"+i(t)+"]");"string"==typeof n?o.contents().filter(function(){return 3===this.nodeType}).first().replaceWith(n):(s=o.closest("li").empty(),e.ui.contextmenu.createEntryMarkup(n,s))},showEntry:function(e,t){var n=this.element.find("a[href=#"+i(e)+"]");n.toggle(t!==!1)}}),e.extend(e.ui.contextmenu,{createEntryMarkup:function(t,n){var s=null;return t.title.match(/^---/)?n.text(t.title):(s=e("<a>",{text:""+t.title,href:"#"+i(t.cmd)}).appendTo(n),t.uiIcon&&s.append(e("<span class='ui-icon'>").addClass(t.uiIcon)),t.disabled&&n.addClass("ui-state-disabled")),s},createMenuMarkup:function(t,n){var i,s,o,r;for(null==n&&(n=e("<ul class='ui-helper-hidden'>").appendTo("body")),i=0;t.length>i;i++)s=t[i],r=e("<li>").appendTo(n),e.ui.contextmenu.createEntryMarkup(s,r),e.isArray(s.children)&&(o=e("<ul>").appendTo(r),e.ui.contextmenu.createMenuMarkup(s.children,o));return n}})})(jQuery,window,document);